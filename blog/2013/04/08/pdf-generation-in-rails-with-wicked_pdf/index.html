<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <!-- (1) Optimize for mobile versions: http://goo.gl/EOpFl -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- (1) force latest IE rendering engine: bit.ly/1c8EiC9 -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>PDF generation in Rails</title>

  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  

  <meta property="og:site_name" content="Codingarena" />
  <meta property="og:title" content="PDF generation in Rails"/>
  
  <meta property="og:description" content="Recently my friend was working on a project that had a requirement to export the html page to PDF. He had some issues setting this up. So I thought I would write this article, so that it will be he..." />
  
  <meta property="og:image" content="http://codingarena.in/blog/assets/images/manu.png" />
  <meta property="og:url" content="http://codingarena.in/blog/blog/2013/04/08/pdf-generation-in-rails-with-wicked_pdf/" >
  <meta property="og:type" content="blog" />
  <meta property="article:published_time" content="2013-04-08T00:00:00+05:30">

  <link rel="canonical" href="http://codingarena.in/blog/blog/2013/04/08/pdf-generation-in-rails-with-wicked_pdf/">

  <link rel="shortcut icon" href="/blog/assets/images/favicon.ico">
  <link rel="stylesheet" href="//brick.a.ssl.fastly.net/Linux+Libertine:400,400i,700,700i/Open+Sans:400,400i,700,700i">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="stylesheet" type="text/css" media="screen" href="/blog/css/main.css" />
  <link rel="stylesheet" type="text/css" media="print" href="/blog/css/print.css" />
</head>
  <body itemscope itemtype="http://schema.org/Article">
    <!-- header start -->

<a href="http://codingarena.in" class="logo-readium"><span class="logo" style="background-image: url(/blog/assets/images/manu.png)"></span></a>

<!-- header end -->
    <main class="content" role="main">
      <article class="post">
        
        <div class="noarticleimage">
          <div class="post-meta">
            <h1 class="post-title">PDF generation in Rails</h1>
            <div class="cf post-meta-text">
              <div class="author-image" style="background-image: url(/blog/assets/images/manu.png)">Blog Logo</div>
              <h4 class="author-name" itemprop="author" itemscope itemtype="http://schema.org/Person"></h4>
              on
              <time datetime="2013-04-08T00:00:00+05:30">08 Apr 2013</time>
              tagged on <span class="post-tag-">, <a href="/tag/"></a></span>
            </div>
          </div>
        </div>
        <br>
        <br>
        <br>
        
        <section class="post-content">
          <div class="post-reading">
            <span class="post-reading-time"></span> read
          </div>
          <a name="topofpage"></a>
          <p>Recently my friend was working on a project that had a requirement to export the html page to PDF. He had some issues setting this up. So I thought I would write this article, so that it will be helpful for  anyone who faces the same issue. It’s easy getting your pdf in rails as long as you follow the right steps ;) (But unfortunately my good friend doesnt always do that for some reason of his own - No offense intended ;) )</p>

<!--more-->

<p>If you are using Rails, then you have this wonderful <a href="http://rubygems.org">rubygems</a> where you can find a no of gems for pdf generation. The suggested ones are <a href="http://rubygems.org/gems/prawn">prawn</a> and <a href="http://rubygems.org/gems/wicked_pdf">wicked_pdf</a>.</p>

<h2 id="which-one-to-chose-">Which one to chose ?</h2>

<p>For me wicked_pdf is very simple to understand and it gets your job done very quickly if you follow all the right steps, while Prawn restricts you to the old table, grids layout. But ultimately its you who will have to decide which to use depending upon your specific requirements.</p>

<p>I will be using wicked_pdf and ubuntu.</p>

<h2 id="wickedpdf">Wicked_pdf</h2>

<p>Wicked_pdf uses a shell utility <a href="http://code.google.com/p/wkhtmltopdf/">Wkhtmltopdf</a>  to serve a PDF file to a user from a HTML page. In other words, rather than dealing with a PDF generation DSL of some sort, you simply write an HTML view as you would normally, then let Wicked take care of the hard stuff</p>

<h2 id="now-what-is-wkhtmltopdf-">Now what is wkhtmltopdf ?</h2>

<p><a href="http://code.google.com/p/wkhtmltopdf">Wkhtmltopdf</a> is an c++ executable that <a href="https://github.com/mileszs/wicked_pdf">wicked_pdf</a><span> gem essentialy wraps. It works great for pdf generation of tables reports etc. The WK in wkhtmltopdf stands for webkit which is the browser engine that is used to render HTML and java-script  Chrome uses this same engine.</span></p>

<p>Installing it simply via
    sudo apt-get install wkhtmltopdf</p>

<p>on Ubuntu will install a reduced functionality version which is probably not what you want. According to the manual the reduced functionality version does not include the following features.
Printing more then one HTML document into a PDF file. </p>

<p>Running without an X11 server. 
Adding a document outline to the PDF file. 
Adding headers and footers to the PDF file.
Generating a table of contents. 
Adding links in the generated PDF file. 
Printing using the screen media-type. 
Disabling the smart shrink feature of webkit. 
If you need any of these, then you need to setup the static version of wkhtmltopdf.
First check OS is 32 bit or 64 bit by using following command
Try
		uname -m</p>

<p>Run following command for installing dependencies.
		sudo apt-get install openssl build-essential xorg libssl-dev libxrender-dev</p>

<p>Based on OS download wkhtmltopdf package from following site
<a href=" http://code.google.com/p/wkhtmltopdf/downloads/list">http://code.google.com/p/wkhtmltopdf/downloads/list</a></p>

<p>Then extract using command</p>

<pre><code>	tar xvjf wkhtmltopdf-0.11.0_rc1-static-amd64.tar.bz2
</code></pre>

<p>Then move extracted DIR to usr/local/bin folder</p>

<pre><code>	sudo mv wkhtmltopdf-0.11.0_rc1-static-amd64 /usr/local/bin/wkhtmltopdf
</code></pre>

<p>Check wkhtmltopdf is installed or not using following command</p>

<pre><code>	which wkhtmltopdf
</code></pre>

<h2 id="using-wickedpdf-in-your-rails-app">Using wicked_pdf in your Rails app</h2>

<p>Add this to your Gemfile</p>

<pre><code>	gem 'wicked_pdf'
</code></pre>

<p>You may also need to add the following to your config/initializers/mime_types.rb&lt;/p&gt;</p>

<pre><code>	Mime::Type.register "application/pdf", :pdf
</code></pre>

<h2 id="basic-usage">Basic Usage:</h2>

<pre><code>class Invoice &lt; ApplicationController
  def show
    respond_to do |format|
      format.html
      format.pdf do
        render :pdf =&gt; "invoice"
      end
    end
  end
end
</code></pre>

<p>If you need to include stylesheets and javascript inside the generated document, the wicked_pdf gem has helpers for that</p>

<pre><code>	&lt;%= wicked_pdf_stylesheet_link_tag "pdf_stylesheet" -%&gt;
	&lt;%= wicked_pdf_javascript_include_tag "pdf_javascript" %&gt;
</code></pre>

<h2 id="some-tweaks-and-tips">Some tweaks and tips</h2>

<p>If you need to hide some links in your generated PDF document then you can use a custom stylesheet which defines the properties for print media and can include the same using the above helper method.</p>

<p>Eg: You have a button on your html page and you dont want that to be displayed when you generate the PDF.</p>

<p>If you have the following link with css selector “print_friendly”</p>

<pre><code>	&lt;%= link_to "Print" , "http://example.com/download", :id=&gt;"print_friendly" %&gt;
</code></pre>

<p>and have a stylesheet with the css properties for print media as</p>

<pre><code>	@media print {
	  #print_friendly{
	  display:hidden;
	  }
	}
</code></pre>

<p>then the link wont be visible inside the generated PDF document</p>

<p>If your page has a lot of javascript and needs longer time for rendering then you can add the following the wicked_pdf</p>

<pre><code>	wkhtmltopdf.exe --javascript-delay 15000 http://example.com/downloads
</code></pre>

<h2 id="some-common-issues">Some common Issues</h2>
<p>###1. Runtime Error###
RuntimeError in XxxxController#show</p>

<p>Failed to execute: /usr/bin/wkhtmltopdf –print-media-type -q - - Error: PDF could not be generated!</p>

  	Rails.root: /apps/rails/show

<p>Check the location of your wkhtmltopdf using which wkhtmltopdf and also run a bundle update command as sometimes your gem in gemfile would be configured with the wrong path.
###2. Is wkhtmltopdf-binary necessary to generated PDF files ?###
No</p>

<p>If you have installed the system libraries and have configured the path correctly in your app correctly, you dont need to install he wkhtmltopdf-binary gem seperately.</p>

<h3 id="wickedpdf-not-rendering-graphs-with-highcharts">3. Wicked_pdf not rendering graphs with HighCharts</h3>
<p>Wkhtmltopdf doesn’t handle transparency/shadows properly and can result in unpredictable results. So the workaround is to add the following options to yo2ur highcharts</p>

<pre><code>		f.options[:plotOptions][:line] = :animation =&gt; false, :shadow =&gt; false, :enableMouseTracking =&gt; false
</code></pre>

<h4 id="as-i-said-earlier-its-easy-getting-your-pdf-in-rails-as-long-as-you-follow-the-right-steps-">As I said earlier it’s easy getting your pdf in rails as long as you follow the right steps ;)</h4>

        </section>
        <footer class="post-footer">
          <section class="share">
            
              
                <a class="icon-twitter" href="http://twitter.com/share?text=PDF+generation+in+Rails&amp;url=http://codingarena.in/blog/2013/04/08/pdf-generation-in-rails-with-wicked_pdf"
                  onclick="window.open(this.href, 'twitter-share', 'width=550,height=255');return false;">
                <i class="fa fa-twitter"></i><span class="hidden">twitter</span>
                </a>
              
            
              
            
          </section>
        </footer>
        <div class="bottom-teaser cf">
          <div class="isLeft">
            <h5 class="index-headline featured"><span>Written by</span></h5>
            <section class="author">
              <div class="author-image" style="background-image: url(/blog/assets/images/manu.png)">Blog Logo</div>
              <h4>Manu S Ajith</h4>
              <p class="bio" style="width:200%"> #programmer, #hacker, #entrepreneur, open source evangelist. #Ruby, #Golang, #Elixir, #JS, Lazy #Blogger. Writes #code for a living.</p>
              <hr>
              <p class="published">Published <time datetime="2013-04-08 00:00">08 Apr 2013</time></p>
            </section>
          </div>
          
        </div>
        
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            var disqus_shortname = 'codingarenablog'; // required: replace example with your forum shortname
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        
      </article>
    </main>
    <div class="bottom-closer">
      <div class="inner">
        <a href="/blog/" class="btn">Back to Home</a>
      </div>
    </div>
    <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
<script type="text/javascript" src="/blog/assets/js/jquery.fitvids.js"></script>
<script type="text/javascript" src="/blog/assets/js/index.js"></script>
<script type="text/javascript" src="/blog/assets/js/readingTime.min.js"></script>
<script>
(function ($) {
  "use strict";
  $(document).ready(function(){

    var $window = $(window),
    $image = $('.post-image-image, .teaserimage-image');
    
      $window.on('scroll', function() {
        var top = $window.scrollTop();

        if (top < 0 || top > 1500) { return; }
        $image
          .css('transform', 'translate3d(0px, '+top/3+'px, 0px)')
          .css('opacity', 1-Math.max(top/700, 0));
      });
      $window.trigger('scroll');

      var height = $('.article-image').height();
      $('.post-content').css('padding-top', height + 'px');

      $('a[href*=#]:not([href=#])').click(function() {
        if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'')
         && location.hostname == this.hostname) {
          var target = $(this.hash);
          target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
          if (target.length) {
            $('html,body').animate({ scrollTop: target.offset().top }, 500);
            return false;
          }
        }
      });

  });
}(jQuery));
</script>
  </body>
</html>
